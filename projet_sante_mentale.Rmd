---
title: "projet"
output: html_document
date: "2024-04-09"
---


1) ACM

```{r}
rm(list=ls())
sante_mentale=read.csv("sante_mentale.csv")
sante_mentale <- sante_mentale[, 1:(ncol(sante_mentale) - 3)]
sante_mentale
```

# 1, analyse d'une sous partie
# Sous partie

```{r}
library(dplyr)
# Permet de créer une sous base de donnée avec juste les variables qu'on veut
sub_database <- sante_mentale %>% 
  select(age, pays_etude, alternance, celibataire, sport,niveau_etude, depressif)

# Enlève les lignes où il y a Non
sub_database <- sub_database[sub_database$niveau_etude != "Non",]

#Prend pas en compte ce qui ont moins de 18 ans
sub_database <- sub_database[sub_database$age >= 18, ]

#Enlève les trucs vides
sub_database <- na.omit(sub_database)

# Enlève les trucs vide où il y a " " au lieu de ""
sub_database <- sub_database[rowSums(sub_database == "" | sub_database == " ") == 0, ]
head(sub_database)
```

Permet de regrouper les différents pays d'étude
```{r}
# C'est la fréquence max qu'on accepte avant de garder comme une catégorie
threshold <- 5  # Set a threshold for the minimum frequency

# Permet d'avoir la fréquence de différente catégorie de chaque variable de la subdatabase
level_frequencies <- table(sub_database$pays_etude)

# Permet d'avoir les différentes villes qui sont endessous de la fréquence qu'on a mis
rare_levels <- names(level_frequencies[level_frequencies < threshold])

# Puis remplace chaque ville qui sont dans la liste rare_levels par other dansla subdatabase
sub_database$pays_etude <- as.factor(sapply(sub_database$pays_etude, function(level) {
  if (level %in% rare_levels) "Other" else level
}))

# Change level "Paris" to "France", les levels c'est juste les différentes catégories. Chaque levels correspond à une catégorie
levels(sub_database$pays_etude)[levels(sub_database$pays_etude) == "Paris"] <- "France"
```



Permet de regrouper les Bac +1, +2 et +3, et un autre groupe avec +4, +5
```{r}

# Permet de regrouperpar Licence (Bac +1-3) et Master (Bac +4-5) et le reste, comme ça on a moins de catégorie derrière, ça va aider pour l'acm, l'acf etc 
sub_database$niveau_etude <- as.factor(sapply(sub_database$niveau_etude, function(x) {
  if (x %in% c("Bac +1", "Bac +2", "Bac +3")) {
    "BAC+1-3"
  } else if (x %in% c("Bac +4", "Bac +5")) {
    "BAC+4-5"
  } else {
    x  # This line ensures that all other levels remain unchanged
  }
}))
```


As_factors of all variables
```{r}
# Transforme tout ce qui est en caractère en asfactor
sub_database[] <- lapply(sub_database, function(x) if(is.character(x)) factor(x) else x)

# ACM ne marche que avec des factors, il faut donc mettre en factor les âges aussi
# CONSEIL : Je pense qu'il faudrait regrouper les gens par tranches d'âge aussi
sub_database$age <- factor(sub_database$age)
sub_database
```

# Analyse ACM
On a toutes les conditions nécessaires au bon fonctionnement de l'ACM maintenant
```{r}
library(FactoMineR)
# Perform MCA on the sub-database
mca_results <- MCA(sub_database, graph = FALSE)
```

```{r}
# If you have the factoextra package installed, you can visualize the results:
library(factoextra)
fviz_mca_var(mca_results, repel = TRUE)
# Individual factor map colored by 'depressif' levels
fviz_mca_ind(mca_results, label = "none", habillage = "depressif", 
               palette = "jco", addEllipses = TRUE, repel = TRUE)
```
C'est donc très difficle à lire à cause de tous les niveaux. Faisons d'abord juste avec le pays d'étude, dépressif et age pour voir ce qu'on obtient.

```{r}
library(dplyr)
sub_database_age_pays <- sante_mentale %>% 
  select(age, pays_etude, depressif)

sub_database <- sub_database[sub_database$niveau_etude != "Non",]
sub_database_age_pays <- sub_database_age_pays[sub_database_age_pays$age >= 18, ]
sub_database_age_pays <- na.omit(sub_database_age_pays)
sub_database_age_pays <- sub_database_age_pays[rowSums(sub_database_age_pays == "" | sub_database_age_pays == " ") == 0, ]
head(sub_database_age_pays)
```

Comme d'hab, ici on nettoie le pays_etude
```{r}
threshold <- 5  # Set a threshold for the minimum frequency
level_frequencies <- table(sub_database_age_pays$pays_etude)
rare_levels <- names(level_frequencies[level_frequencies < threshold])
sub_database_age_pays$pays_etude <- as.factor(sapply(sub_database_age_pays$pays_etude, function(level) {
  if (level %in% rare_levels) "Other" else level
}))

# Change level "Paris" to "France", les levels c'est juste les différentes catégories. Chaque levels correspond à une catégorie
levels(sub_database_age_pays$pays_etude)[levels(sub_database_age_pays$pays_etude) == "Paris"] <- "France"
```


```{r}
sub_database_age_pays[] <- lapply(sub_database_age_pays, function(x) if(is.character(x)) factor(x) else x)
sub_database_age_pays$age <- factor(sub_database_age_pays$age)
sub_database_age_pays
```


Puis on fait l'ACM
```{r}
library(FactoMineR)
# Perform MCA on the sub-database
mca_results <- MCA(sub_database_age_pays, graph = FALSE)
```

```{r}
# If you haven't installed factoextra, uncomment the line below to install it
# install.packages("factoextra")
library(factoextra)

# Plotting only variable categories (qualitative variable levels)
fviz_mca_var(mca_results, repel = TRUE)

```



```{r}
sante_mentale_clean <- na.omit(sante_mentale) 
#sante_mentale_clean$alternance<- as.factor(sante_mentale_clean$alternance)
sante_mentale_clean[] <- lapply(sante_mentale_clean, function(x) if(is.character(x)) factor(x) else x)
print(dim(sante_mentale_clean))

sante_mentale_clean
```





```{r}
library(factoextra)
```


```{r}
mca_results <- MCA(sante_mentale_clean, graph = FALSE)
```

