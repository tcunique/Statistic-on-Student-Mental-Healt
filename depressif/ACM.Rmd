---
title: "projet"
output: html_document
date: "2024-04-09"
---


1) ACM

```{r}
rm(list=ls())
sante_mentale=read.csv("sante_mentale_regrouped.csv")
sante_mentale
```

# 1, analyse d'une sous partie
# Sous partie

```{r}
library(dplyr)
# Permet de créer une sous base de donnée avec juste les variables qu'on veut
 sub_database <- sante_mentale %>% 
   dplyr::select(age, pays_etude, alternance, celibataire, sport,niveau_etude, depressif,anxiété)
 
  sub_database <- sante_mentale %>% 
   dplyr::select(age, niveau_etude, depressif)

```


As_factors of all variables
```{r}
# Transforme tout ce qui est en caractère en asfactor
sub_database[] <- lapply(sub_database, function(x) if(is.character(x)) factor(x) else x)

# ACM ne marche que avec des factors, il faut donc mettre en factor les âges aussi
# CONSEIL : Je pense qu'il faudrait regrouper les gens par tranches d'âge aussi
sub_database$age <- factor(sub_database$age)
sub_database
```

# Analyse ACM
On a toutes les conditions nécessaires au bon fonctionnement de l'ACM maintenant
```{r}
library(FactoMineR)
# Perform MCA on the sub-database
mca_results <- MCA(sub_database, graph = FALSE)
# Afficher la variance expliquée par chaque dimension
print(mca_results$eig)
```

```{r}
# If you have the factoextra package installed, you can visualize the results:
library(factoextra)
fviz_mca_var(mca_results, repel = TRUE)
# Individual factor map colored by 'depressif' levels
fviz_mca_ind(mca_results, label = "none", habillage = "depressif", 
               palette = "jco", addEllipses = TRUE, repel = TRUE)

fviz_mca_var(mca_results, choice = "mca.cor", axes = c(1, 2), repel = TRUE)
```


Prenons maintenat les variables que le tset de chisq 2 nous a conseillé : 
- ville voyer
- niveau etude
- anxiété
- diagnostic_depressf
- depressif
- suivi_medical_depressif
```{r}
# Permet de créer une sous base de donnée avec juste les variables qu'on veut
sub_database_chisq <- sante_mentale %>% 
  dplyr::select(ville_foyer, niveau_etude, anxiété, depressif,, alcool, Conflits.Familiaux, tiers_temps )

sub_database_chisq <- sante_mentale %>% 
  dplyr::select(depressif,ville_foyer,niveau_etude,anxiété,alcool,Conflits.Familiaux,tiers_temps,alcool,vie_sociale,Travail_domicile)

# Transforme tout ce qui est en caractère en asfactor
sub_database_chisq[] <- lapply(sub_database_chisq, function(x) if(is.character(x)) factor(x) else x)
```


# Analyse ACM
On a toutes les conditions nécessaires au bon fonctionnement de l'ACM maintenant
```{r}
library(FactoMineR)
# Perform MCA on the sub-database
mca_results_chisq <- MCA(sub_database_chisq)
# Afficher la variance expliquée par chaque dimension
print(mca_results_chisq$eig)
```

```{r}
# If you have the factoextra package installed, you can visualize the results:
library(factoextra)

# Visualiser le cercle de corrélation des variables pour les deux premières dimensions
fviz_mca_var(mca_results_chisq, choice = "mca.cor", axes = c(1, 2), repel = TRUE)
fviz_mca_var(mca_results_chisq, choice = "mca.cor", axes = c(2, 3), repel = TRUE)
fviz_mca_var(mca_results_chisq, choice = "mca.cor", axes = c(4, 5), repel = TRUE)
fviz_mca_var(mca_results_chisq, choice = "mca.cor", axes = c(1,5), repel = TRUE)

plot_mca = plot.MCA(mca_results_chisq, invisible=c("ind"), hab="quali", palette=palette(c("blue","orange","darkgreen")),repel = TRUE) +
              theme_minimal(base_size = 20) +  # Increase base text size
  theme(axis.text.x = element_text(size = 18), 
        axis.text.y = element_text(size = 18),
        plot.title = element_text(size = 24),
        plot.background = element_rect(fill = "white", color = NA), # Ensure white background
        panel.background = element_rect(fill = "white", color = NA)) # Ensure panel background is white

# Enregistrer l'image
ggsave("mca_factor_map_large.png",plot = plot_mca, width = 24, height = 16, dpi = 300)

print(plot_mca)
```
```{r}
# Scree plot to visualize the variance explained by each dimension
fviz_screeplot(mca_results_chisq, addlabels = TRUE, ylim = c(0, 50))

```
```{r}

```
```{r}

```


```{r}
# Charger les bibliothèques nécessaires
library(FactoMineR)
library(factoextra)

# Charger les données depuis le fichier CSV
data <- read.csv('sante_mentale_clean.csv')

# Vérifiez que les colonnes existent
if (!all(c("niveau_etude", "ville_etude", "age") %in% colnames(data))) {
  stop("Les colonnes 'niveau_etude', 'ville_etude' ou 'age' ne sont pas présentes dans le fichier CSV.")
}

# Sélectionner les colonnes qualitatives pour l'ACM
qualitative_data <- data[, c("niveau_etude", "ville_etude")]

# Ajouter la variable quantitative en tant que variable supplémentaire
mca_result <- MCA(qualitative_data, quanti.sup = which(colnames(data) == "age"), graph = FALSE)

# Visualiser le cercle de corrélation
fviz_mca_var(mca_result, 
             repel = TRUE, # Évite le chevauchement des labels
             col.var = "blue", # Couleur des variables qualitatives
             col.quanti.sup = "red", # Couleur de la variable quantitative supplémentaire
             ggtheme = theme_minimal()) +
  ggtitle("Cercle de corrélation (ACM)")

```

